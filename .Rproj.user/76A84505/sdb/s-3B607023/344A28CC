{
    "collab_server" : "",
    "contents" : "\n# Setup ----------------------------------------------------------------------\n\n# Activate packages\nsource(\"https://bioconductor.org/biocLite.R\")\nbiocLite(c(\"Biostrings\",\n           \"DECIPHER\"))\n\nlibrary(quiet=TRUE,\"rgl\")\nlibrary(quiet=TRUE,\"mclust\")\nlibrary(quiet=TRUE,\"ggplot2\")\nlibrary(quiet=TRUE,\"Biostrings\")\nlibrary(quiet=TRUE,\"DECIPHER\")\n\n\n\n\n# Import necessary files ----------------------------------------------------------------------\n\nfolder    <- \"C:\\\\Users\\\\T\\\\OneDrive\\\\1-Scripts\\\\GitHub\\\\DefSpace\"\nsetwd(folder)\n\nSAPCA.cis <- readRDS(\"data\\\\CisDef.reference.PCA.RDS\")\nSAPCA.tra <- readRDS(\"data\\\\TransDef.reference.PCA.RDS\")\n\nview.cis <- readRDS(\"data\\\\CisDef.viewangle.RDS\")\nview.tra <- readRDS(\"data\\\\TransDef.viewangle.RDS\")\n\nBLOSUM40 <- readRDS(\"data\\\\BLOSUM.RDS\")\n\n# User-inputted data is a single sequenece\n# example below\nsequence <- \"RTCESQSHRFKGPCSRDSNCATVCLTEGFSGGRCPWIPPRCFFFCTSPC\" # cis defensin example\n\n# Plot cis (before use inputs any data) -----------------------------------------------\n\ncolours<-palette(c(\"blue\",            #1 Plant extreme\n                   \"darkolivegreen4\", #2 Plant main\n                   \"grey\",            #3 Intermed\n                   \"purple1\",         #4 Plant sex\n                   \"orange\",          #5 Plant his\n                   \"maroon\",          #6 Invert\n                   \"red\"))            #7 Tox\nplot_3Dclusters(SAPCA.cis, plotPCs = 1:3, axeslabels = c(\"\",\"\",\"\"))\nrgl::par3d(view.cis)\n\n\n\n# Plot trans (before user inputs any data)  ------------------------------------------------\n\ncolours<-palette(c(\"blue\",     #1 Theta\n                   \"red\",      #2 Aalpha\n                   \"orange\",   #3 Beta\n                   \"purple\"))  #4\nplot_3Dclusters(SAPCA.tra, plotPCs = c(1,2,4), axeslabels = c(\"\",\"\",\"\"))\nrgl::par3d(view.tra)\n\n\n# Assign sequence class  ----------------------------------------------------------------------\n\n# Checkbox for whether to check alignments to both superfams\nif(is.cis){\n  SAPCA.match  <- SAPCA.cis\n  newseq.match <- seq.MSA.add(SAPCA.cis,sequence,\"cis-Defensins\")\n  match        <- \"cis-Defensin\"\n}else if(is.tra){\n  SAPCA.match  <- SAPCA.tra\n  newseq.match <- seq.MSA.add(SAPCA.tra,sequence,\"trans-Defensins\")\n  match        <- \"trans-Defensin\"\n}else{\n  newseq.cis <- seq.MSA.add(SAPCA.cis,sequence,\"cis-Defensins\")\n  newseq.tra <- seq.MSA.add(SAPCA.tra,sequence,\"trans-Defensins\")\n  # Which is the better match\n  if(newseq.cis$aln.hit.score>=newseq.tra$aln.hit.score){\n    SAPCA.match  <- SAPCA.cis\n    newseq.match <- newseq.cis\n    view         <- view.cis\n    plotPCs      <- c(1,2,3)\n    match        <- \"cis-Defensin\"\n  }else{\n    SAPCA.match  <- SAPCA.tra\n    newseq.match <- newseq.tra\n    view         <- view.tra\n    plotPCs      <- c(1,2,4)\n    match        <- \"trans-Defensin\"\n  }\n}\n\n# Rotation, cluster assignment and completion for whichever SAPCA matches sequence\nnewseq.r  <- seq.rotate    (SAPCA.match, newseq.match)\nnewseq.c  <- seq.clust.add (SAPCA.match, newseq.r)\nSAPCA.add <- seq.SAPCA.add (SAPCA.match, newseq.r, newseq.c)\n\n\n# Plot combined SAPCA -------------------------------------------------------------------\nif(match==\"cis-Defensin\"){\n  colours<-palette(c(\"blue\",            #1 Plant extreme\n                     \"darkolivegreen4\", #2 Plant main\n                     \"grey\",            #3 Intermed\n                     \"purple1\",         #4 Plant sex\n                     \"orange\",          #5 Plant his\n                     \"maroon\",          #6 Invert\n                     \"red\"))            #7 Tox\n}\nif(match==\"trans-Defensin\"){\n  colours<-palette(c(\"blue\",     #1 Theta\n                     \"red\",      #2 Aalpha\n                     \"orange\",   #3 Beta\n                     \"purple\"))  #4\n}\n\nplot_3Dclusters(SAPCA.add,\n                plotPCs = plotPCs,\n                labels = \"query\",\n                radius = c(2,rep(0.3,nrow(SAPCA.add$numerical.alignment$MSA)-1)))\nrgl::par3d(view)\n\n# Plot comparison histograms ------------------------------------------------------------------\naln.cistra <- c(newseq.tra$aln.all.score,newseq.cis$aln.all.score)\nhist(newseq.cis$aln.all.score,\n     xlim   = c(min(aln.cistra),1),\n     ylim   = c(0,10),\n     breaks = seq(min(range(aln.cistra)-0.5),\n                  max(range(aln.cistra)+0.5),\n                  0.02),\n     col    = rgb(0,0.5,0,0.5), # green\n     freq   = FALSE,\n     xlab   = \"Similarity\",\n     main   = \"\")\nhist(newseq.tra$aln.all.score,\n     breaks = seq(min(range(aln.cistra)-0.5),\n                  max(range(aln.cistra)+0.5),\n                  0.02),\n     col    = rgb(0,0,0.8,0.5), # blue\n     freq   = FALSE,\n     add    = TRUE)\nbox()\n\n\n\n# Info  ----------------------------------------------------------------------\n\nas.fasta(SAPCA.add$numerical.alignment$MSA[rownames(closest(SAPCA.add,\"query\")),],\n         decolgap = TRUE)\n\npaste(sep=\"\",\"Sequence appears to be a \",match,\" (max similarity = \",percent(newseq.match$aln.hit.score),\")\")\n\n\n\n\n",
    "created" : 1491287618520.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4028172207",
    "id" : "344A28CC",
    "lastKnownWriteTime" : 1491286165,
    "last_content_update" : 1491286165,
    "path" : "C:/Users/T/OneDrive/1-Scripts/GitHub/DefSpace/R/Workflow.R",
    "project_path" : "R/Workflow.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}